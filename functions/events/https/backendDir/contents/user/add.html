{|@ wrapper |}
{|> header |}

<div class="col12 grid1 gap1">
    <div class="col1"> <label>name</label> <input id="name" type="text"></div>
    <div class="col1"> <label>email</label> <input id="email" type="text"></div>
    <div class="col1"> <label>description</label> <input id="description" type="text"></div>
    <div class="col1"> <label>order</label> <input id="order" type="text"></div>
    <button class="col1" type="button" id="create_button" data-url="/{| backendFirstPath |}/user-create">create</button>
</div>

{|> footer |}

<script type="module">

    import { Base } from '/{| backendFirstPath |}/base.js';
    var base = Base.init()

    const createBtnElement = document.querySelector('#create_button')

    let processing = false
    createBtnElement.addEventListener('click', event => {

        // get target
        const target = event.currentTarget

        // processing then can't send request
        if (processing) {
            return
        }

        // start processing
        processing = true
        event.currentTarget.disabled = true;

        const url = event.currentTarget.dataset.url
        const name = document.querySelector('#name')
        const email = document.querySelector('#email')
        const description = document.querySelector('#description')
        const order = document.querySelector('#order')

        const body = {
            name,
            email,
            description,
            order,
        }

        console.log(url)

        // request to server
        base.fetchServer(url, body)
            .then(result => {
                
                console.log(result)
                // get code
                const code = result.code

                // let messages = []
                // result.messages.forEach(message => {

                //     // rebuild message
                //     messages.push(message.content)

                //     // get selector from key
                //     let key = message.key
                //     const selector = key = ! null ? `.${key.replace('.', ' .')}` : false

                //     // has selector
                //     if (selector) {
                //         const element = document.querySelector(selector)

                //         // code is success
                //         if (code === 'success') {
                //             // then remove _modified class
                //             element.classList.remove('_modified')

                //             // get new value from result balues
                //             let value = Object.assign({}, result.values)
                //             message.key.split('.').forEach(path => {
                //                 value = value[path.trim()]
                //             })

                //             // value is array then change to string
                //             value = Array.isArray(value) ? value.join(', ') : value

                //             // set new value
                //             element.value = value

                //             // set new value to data dafault
                //             element.dataset.default = value

                //             // set modifier class success whith clear time
                //             base.setModifierClass(element, code, 4000)
                //         } else {
                //             // set modifier class error or warning
                //             base.setModifierClass(element, code)
                //         }
                //     }
                // })

                // set notice
                // base.setNotice(result.code, messages)

                // end process
                // processing = false
                // event.target.disabled = false;
            })
            .catch(err => {
                base.setNotice('error', [err.message])
                console.log(err)

                // end process
                processing = false
                event.target.disabled = false;
            })
    })

</script>