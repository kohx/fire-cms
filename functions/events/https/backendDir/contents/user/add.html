{|@ wrapper |}
{|> header |}

<div class="col12 grid1 gap1">
    <div class="col1"> <label for="name">name</label> <input id="name" class="target_item" type="text"></div>
    <div class="col1"> <label for="email">email</label> <input id="email" class="target_item" type="text"></div>
    <div class="col1"> <label for="password">password</label> <input id="password" class="target_item" type="password"></div>
    <div class="col1"> <label for="confirm">confirm</label> <input id="confirm" class="target_item" type="password"></div>
    <div class="col1"> <label for="description">description</label> <input id="description" class="target_item" type="text"></div>
    <div class="col1"> <span>role</span>
        <div>
            {|* roles : key : role |}
            <input{|# equal(key, 1)|} checked{|/#|} class="target_item role_item" id="{|role|}" name='role' type="radio" value="{|role|}">
            <label for="{|role|}">{|role|}</label>
            {|/*|}
        </div>
        <div class="col1"> <label for="order">order</label> <input id="order" class="target_item" type="text"></div>
        <button class="col1 target_item" type="button" id="create_button" data-url="/{| backendFirstPath |}/user-create"
            data-backend_url="/{| backendFirstPath |}/users">create</button>
    </div>

    {|> footer |}

    <script type="module">

        import { Base } from '/{| backendFirstPath |}/base.js';
        var base = Base.init()

        const createBtnElement = document.querySelector('#create_button')

        let processing = false
        createBtnElement.addEventListener('click', event => {

            // get target
            const target = event.currentTarget

            // processing then can't send request
            if (processing) {
                return
            }

            // start processing
            processing = true
            event.currentTarget.disabled = true;

            const url = event.currentTarget.dataset.url
            const backendUrl = event.currentTarget.dataset.backend_url
            const nameItem = document.querySelector('#name')
            const emailItem = document.querySelector('#email')
            const passwordItem = document.querySelector('#password')
            const confirmItem = document.querySelector('#confirm')
            const descriptionItem = document.querySelector('#description')
            const roleItem = document.querySelector('.role_item:checked')
            const orderItem = document.querySelector('#order')

            const body = {
                name: nameItem.value,
                email: emailItem.value,
                password: passwordItem.value,
                confirm: confirmItem.value,
                description: descriptionItem.value,
                role: roleItem != null ? roleItem.value : '',
                order: orderItem.value,
            }

            // request to server
            base.fetchServer(url, body)
                .then(result => {

                    console.log(result)
                    // get code
                    const code = result.code

                    let messages = []
                    result.messages.forEach(message => {

                        // rebuild message
                        messages.push(message.content)

                        // get selector from key
                        let key = message.key
                        let selector = (key = ! null) ? `#${message.key}` : false

                        // has selector
                        if (selector) {
                            const element = document.querySelector(selector)

                            // code is success
                            if (code === 'success') {
                                // result status is true then send to backend top index
                                window.location.assign(`${window.location.origin}/${backendUrl}`)
                            } else {
                                if (element) {
                                    // set modifier class error or warning
                                    base.setModifierClass(element, code)
                                }
                            }
                        }
                    })

                    // set notice
                    base.setNotice(result.code, messages)

                    // end process
                    processing = false
                    event.target.disabled = false;
                })
                .catch(err => {

                    base.setNotice('error', [err.message])
                    console.log(err)

                    // end process
                    processing = false
                    event.target.disabled = false;
                })
        })

    </script>