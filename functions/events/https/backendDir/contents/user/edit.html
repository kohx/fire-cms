{|@ wrapper |}
{|> header |}

<div class="col12 grid1 gap1">
    <form>
        <div class="col1"><input id="uid" name="uid" type="text" readonly value="{| target.uid |}"></div>
        <div class="col1"><label for="name">name</label><input id="name" class="target_item" type="text" name="name" value="{| target.name |}"></div>
        <div class="col1"><label for="email">email</label><input id="email" class="target_item" type="text" name="email" value="{| target.email |}"></div>
        <div class="col1"><label for="password">password</label><input id="password" class="target_item" type="password" name="password" value=""></div>
        <div class="col1"><label for="confirm">confirm</label><input id="confirm" class="target_item" type="password" name="confirm" value=""></div>
        <div class="col1"><label for="description">description</label><input id="description" class="target_item" type="text" name="description" value=""></div>
        <div class="col1">
            <div>role</div>
            <div>
                {|* roles : key : role |}
                <input {|# equal(role, target.role)|} checked{|/#|} class="target_item role_item" id="{|role|}" name='role' type="radio" value="{|role|}"><label for="{|role|}">{|role|}</label>
                {|/*|}
            </div>
        </div>
        <div class="col1"><label for="order">order</label><input id="order" class="target_item" type="text" name="order" value="{| target.order |}">
        </div>
        <div class="col1">
            <div>radio</div>
            <div>
                <input type="radio" id="iii" name='radio' value="iii" checked><label for="iii">iii</label>
                <input type="radio" id="jjj" name='radio' value="jjj"><label for="jjj">jjj</label>
                <input type="radio" id="kkk" name='radio' value="kkk"><label for="kkk">kkk</label>
            </div>
        </div>
        <div class="col1">
            <div>chack</div>
            <div>
                <input type="checkbox" id="aaa" name='chack[]' value="aaa" checked><label for="aaa">aaa</label>
                <input type="checkbox" id="bbb" name='chack[]' value="bbb" checked><label for="bbb">bbb</label>
                <input type="checkbox" id="ccc" name='chack[]' value="ccc"><label for="ccc">ccc</label>
            </div>
        </div>
        <div class="col1">
            <div>select</div>
            <select name="select" id="sss">
                <option value="111">111</option>
                <option value="222" selected>222</option>
                <option value="333">333</option>
            </select>
        </div>
        <div class="col1">
            <div>multiple</div>
            <select multiple name="multiple[]" id="mmm">
                <option value="xxx" selected>xxx</option>
                <option value="yyy">yyy</option>
                <option value="zzz" selected>zzz</option>
            </select>
        </div>
    </form>
    <button class="col1 target_item" type="button" id="update_button" data-request_url="{| backendFirstPath |}/user-update" data-users_url="{| backendFirstPath |}/users">update</button>
</div>

{|> footer |}

<script type="module">

    import { Base } from '/{| backendFirstPath |}/base.js';
    var base = Base.init()

    // get element
    const updateBtnElement = document.querySelector('#update_button')

    // prosess start
    let processing = false

    // click event
    updateBtnElement.addEventListener('click', event => {

        // get button
        const button = event.currentTarget
        
        // get button data
        const requestUrl = `${window.location.origin}/${button.dataset.request_url}`
        const usersUrl = `${window.location.origin}/${button.dataset.users_url}`

        // processing then can't send request
        if (processing) {
            return
        }

        // start processing
        processing = true
        button.disabled = true;

        // not change then show warnning
        let body = base.getBody()
        if(!body) {
            processing = false
            button.disabled = false;
            return
        }

        // add uid because uid is not modified
        body['uid'] = base.defaults.uid
        
        // request to server
        base.fetchServer(requestUrl, body)
            .then(result => {

                // get code
                const code = result.code

                let messages = []
                result.messages.forEach(message => {

                    // rebuild message
                    messages.push(message.content)

                    // get selector from key
                    let key = message.key
                    let selector = (key = ! null) ? `#${message.key}` : false

                    // has selector
                    if (selector) {
                        const element = document.querySelector(selector)

                        // code is success
                        if (code === 'success') {
                            // result status is true then send to backend top index
                            window.location.assign(usersUrl)
                        } else {
                            if (element) {
                                // set modifier class error or warning
                                base.setModifierClass(element, code)
                            }
                        }
                    }
                })

                // set notice
                base.setNotice(result.code, messages)

                // end process
                processing = false
                event.target.disabled = false;
            })
            .catch(err => {

                base.setNotice('error', [err.message])
                console.log(err)

                // end process
                processing = false
                event.target.disabled = false;
            })
    })

</script>