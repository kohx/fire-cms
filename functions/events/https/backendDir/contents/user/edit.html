{|@ wrapper |}
{|> header |}

<div class="col12 grid1 gap1">
    <form>
        <div class="col1"><label>uid</label><input id="uid" type="text" readonly value="{| target.uid |}"></div>
        <div class="col1"><label for="name">name</label><input id="name" class="target_item" type="text" name="name"
                value="{| target.name |}" data-default="{| target.name |}"></div>
        <div class="col1"><label for="email">email</label><input id="email" class="target_item" type="text" name="email"
                value="{| target.email |}" data-default="{| target.email |}"></div>
        <div class="col1"><label for="password">password</label><input id="password" class="target_item" type="password"
                name="password" value="" data-default=""></div>
        <div class="col1"><label for="confirm">confirm</label><input id="confirm" class="target_item" type="password"
                name="confirm" value="" data-default=""></div>
        <div class="col1"><label for="description">description</label><input id="description" class="target_item" type="text"
                name="description" value="" data-default=""></div>
        <div class="col1">
            <div>role</div>
            <div class="radio_frame">
                {|* roles : key : role |}<input {|# equal(role, target.role)|} checked{|/#|} class="target_item role_item"
                    id="{|role|}" name='role' type="radio" value="{|role|}" data-default="{| target.role |}"><label for="{|role|}">{|role|}</label>{|/*|}
            </div>
        </div>
        <div class="col1"><label for="order">order</label><input id="order" class="target_item" type="text" name="order"
                value="{| target.order |}" data-default="order">
        </div>

        <div class="col1">
            <div>chack</div>
            <div class="chack_frame">
                <input type="checkbox" id="aaa" name='chack[]' value="aaa" data-default="aaa" checked><label for="aaa">aaa</label>
                <input type="checkbox" id="bbb" name='chack[]' value="bbb" data-default="bbb"><label for="bbb">bbb</label>
                <input type="checkbox" id="ccc" name='chack[]' value="ccc" data-default="ccc"><label for="ccc">ccc</label>
            </div>

            <div>select</div>
            <div class="select_frame">
                <select name="select" id="sss" data-default="222">
                    <option value="111">111</option>
                    <option value="222" selected>222</option>
                    <option value="333">333</option>
                </select>
            </div>

            <div>multiple</div>
            <div class="select_frame">
                <select multiple name="multiple" id="mmm" data-default="xxx">
                    <option value="xxx" selected>xxx</option>
                    <option value="yyy">yyy</option>
                    <option value="zzz" selected>zzz</option>
                </select>
            </div>
    </form>

    <button class="col1 target_item" type="button" id="update_button" data-request_url="{| backendFirstPath |}/user-update"
        data-users_url="{| backendFirstPath |}/users" data-unique="{| target.uid |}">update</button>
</div>

{|> footer |}

<script type="module">

    import { Base } from '/{| backendFirstPath |}/base.js';
    var base = Base.init()

    // get modified form object
    const defaultValues = base.getForm('form')
    console.log(defaultValues)

    // get element
    const updateBtnElement = document.querySelector('#update_button')

    // prosess start
    let processing = false

    // click event
    updateBtnElement.addEventListener('click', event => {

        // get button
        const button = event.currentTarget

        // processing then can't send request
        if (processing) {
            return
        }

        // start processing
        processing = true
        button.disabled = true;

        const requestUrl = `${window.location.origin}/${button.dataset.request_url}`
        const usersUrl = `${window.location.origin}/${button.dataset.users_url}`
        const unique = button.dataset.unique
        const modifiedItems = document.querySelectorAll('._modified')

        // get modified form object
        const modifiedValues = base.getForm('form')
        console.log(modifiedValues)

        // // not change then show warnning
        // if (modifiedItems.length === 0) {
        //     base.setNotice('warning', ['Nothing has changed.'])
        //     processing = false
        //     button.disabled = false;
        //     return
        // }

        // const body = { uid: unique }
        // const defaultValues = {
        //     name: document.querySelector('#name').dataset.default,
        //     email: document.querySelector('#email').dataset.default,
        //     password: document.querySelector('#password').dataset.default,
        //     confirm: document.querySelector('#confirm').dataset.default,
        //     description: document.querySelector('#description').dataset.default,
        //     role: document.querySelector('.role_item:checked').dataset.default,
        //     order: document.querySelector('#order').dataset.default,
        // }



        // // get body from modified items
        // const body = { uid: unique }
        // Object.keys(modifiedItems).forEach(key => {
        //     // element
        //     const element = modifiedItems[key]

        //     if (['INPUT', 'TEXTAREA'].includes(element.tagName)) {

        //     }
        //     body[element.id] = element.value
        // })

        // console.log(body)


        // const body = {
        //     uid: unique,
        //     name: nameItem.value,
        //     email: emailItem.value,
        //     password: passwordItem.value,
        //     confirm: confirmItem.value,
        //     description: descriptionItem.value,
        //     role: roleItem != null ? roleItem.value : '',
        //     order: orderItem.value,
        // }

        // request to server
        // base.fetchServer(requestUrl, body)
        //     .then(result => {

        //         console.log(result)
        //         // get code
        //         const code = result.code

        //         let messages = []
        //         result.messages.forEach(message => {

        //             // rebuild message
        //             messages.push(message.content)

        //             // get selector from key
        //             let key = message.key
        //             let selector = (key = ! null) ? `#${message.key}` : false

        //             // has selector
        //             if (selector) {
        //                 const element = document.querySelector(selector)

        //                 // code is success
        //                 if (code === 'success') {
        //                     // result status is true then send to backend top index
        //                     window.location.assign(usersUrl)
        //                 } else {
        //                     if (element) {
        //                         // set modifier class error or warning
        //                         base.setModifierClass(element, code)
        //                     }
        //                 }
        //             }
        //         })

        //         // set notice
        //         base.setNotice(result.code, messages)

        //         // end process
        //         processing = false
        //         event.target.disabled = false;
        //     })
        //     .catch(err => {

        //         base.setNotice('error', [err.message])
        //         console.log(err)

        //         // end process
        //         processing = false
        //         event.target.disabled = false;
        //     })
    })

</script>