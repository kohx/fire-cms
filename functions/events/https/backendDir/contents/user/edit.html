{|@ wrapper |}
{|> header |}

<div class="col12 grid1 gap1">
    <form action="form">
        <div class="col1"><label>uid</label><input id="uid" type="text" readonly value="{| target.uid |}"></div>
        <div class="col1"><label for="name">name</label><input id="name" class="target_item" type="text" name="name"
                value="{| target.name |}" data-default="{| target.name |}"></div>
        <div class="col1"><label for="email">email</label><input id="email" class="target_item" type="text" name="email"
                value="{| target.email |}" data-default="{| target.email |}"></div>
        <div class="col1"><label for="password">password</label><input id="password" class="target_item" type="password"
                name="password" value="" data-default=""></div>
        <div class="col1"><label for="confirm">confirm</label><input id="confirm" class="target_item" type="password"
                name="confirm" value="" data-default=""></div>
        <div class="col1"><label for="description">description</label><input id="description" class="target_item" type="text"
                name="description" value="" data-default=""></div>
        <div class="col1">
            <div>role</div>
            <div class="radio_frame">
                {|* roles : key : role |}<input {|# equal(role, target.role)|} checked{|/#|} class="target_item role_item"
                    id="{|role|}" name='role' type="radio" value="{|role|}" data-default="{| target.role |}"><label for="{|role|}">{|role|}</label>{|/*|}
            </div>
        </div>
        <div class="col1"><label for="order">order</label><input id="order" class="target_item" type="text" name="order"
                value="{| target.order |}" data-default="order"></div>
    </form>
    <button class="col1 target_item" type="button" id="update_button" data-request_url="{| backendFirstPath |}/user-update"
        data-users_url="{| backendFirstPath |}/users" data-unique="{| target.uid |}">update</button>
</div>
</div>

{|> footer |}

<script type="module">

    import { Base } from '/{| backendFirstPath |}/base.js';
    var base = Base.init()

    const updateBtnElement = document.querySelector('#update_button')

    let processing = false
    updateBtnElement.addEventListener('click', event => {

        // get target
        const target = event.currentTarget

        // processing then can't send request
        if (processing) {
            return
        }

        // start processing
        processing = true
        target.disabled = true;

        const requestUrl = `${window.location.origin}/${target.dataset.request_url}`
        const usersUrl = `${window.location.origin}/${target.dataset.users_url}`
        const unique = target.dataset.unique
        const modifiedItems = document.querySelectorAll('._modified')

        // not change then show warnning
        if (modifiedItems.length === 0) {
            base.setNotice('warning', ['Nothing has changed.'])
            processing = false
            event.target.disabled = false;
            return
        }

        const body = { uid: unique }
        const defaultValues = {
            name: document.querySelector('#name').dataset.default,
            email: document.querySelector('#email').dataset.default,
            password: document.querySelector('#password').dataset.default,
            confirm: document.querySelector('#confirm').dataset.default,
            description: document.querySelector('#description').dataset.default,
            role: document.querySelector('.role_item:checked').dataset.default,
            order: document.querySelector('#order').dataset.default,
        }
        console.log(defaultValues)
        var formElement = document.querySelector("form")
        var formData = new FormData(formElement);
        for (var pair of formData.entries()) {
            console.log(pair[0])
            console.log(defaultValues[pair[0]])
            // console.log(pair[0] + ': ' + pair[1])
        }


        // // get body from modified items
        // const body = { uid: unique }
        // Object.keys(modifiedItems).forEach(key => {
        //     // element
        //     const element = modifiedItems[key]

        //     if (['INPUT', 'TEXTAREA'].includes(element.tagName)) {

        //     }
        //     body[element.id] = element.value
        // })

        // console.log(body)


        // const body = {
        //     uid: unique,
        //     name: nameItem.value,
        //     email: emailItem.value,
        //     password: passwordItem.value,
        //     confirm: confirmItem.value,
        //     description: descriptionItem.value,
        //     role: roleItem != null ? roleItem.value : '',
        //     order: orderItem.value,
        // }

        // request to server
        // base.fetchServer(requestUrl, body)
        //     .then(result => {

        //         console.log(result)
        //         // get code
        //         const code = result.code

        //         let messages = []
        //         result.messages.forEach(message => {

        //             // rebuild message
        //             messages.push(message.content)

        //             // get selector from key
        //             let key = message.key
        //             let selector = (key = ! null) ? `#${message.key}` : false

        //             // has selector
        //             if (selector) {
        //                 const element = document.querySelector(selector)

        //                 // code is success
        //                 if (code === 'success') {
        //                     // result status is true then send to backend top index
        //                     window.location.assign(usersUrl)
        //                 } else {
        //                     if (element) {
        //                         // set modifier class error or warning
        //                         base.setModifierClass(element, code)
        //                     }
        //                 }
        //             }
        //         })

        //         // set notice
        //         base.setNotice(result.code, messages)

        //         // end process
        //         processing = false
        //         event.target.disabled = false;
        //     })
        //     .catch(err => {

        //         base.setNotice('error', [err.message])
        //         console.log(err)

        //         // end process
        //         processing = false
        //         event.target.disabled = false;
        //     })
    })

</script>